<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Workout Helper</title>
  
    <!-- PWA: meta + manifest -->
  <meta name="theme-color" content="#0b0f14" />
  <meta name="description" content="Workout Helper ‚Äì guided sets, timers, swaps, quotes, and audio." />
  <link rel="manifest" href="manifest.webmanifest" />

  <!-- PWA Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-512.png">

  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background:#0b0f14; color:#e8eef6; }
    .wrap { max-width: 920px; margin: 0 auto; padding: 16px; }
    .top { display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .pill { background:#141c26; border:1px solid #243446; padding:10px 12px; border-radius:999px; }
    .time { font-variant-numeric: tabular-nums; font-weight:900; letter-spacing:0.5px; }
    .big { font-size: 20px; }

    .tabs { display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; }
    .day-select {
      padding:8px 10px;
      border-radius:999px;
      border:1px solid #2b3f56;
      background:#152235;
      color:#e8eef6;
      font-weight:600;
      font-size:14px;
    }
    .day-select:focus {
      outline:none;
      border-color:#355b8f;
    }
    .tabbtn{
      border-radius:999px; padding:10px 12px; border:1px solid #2b3f56;
      background:#152235; color:#e8eef6; font-weight:900; cursor:pointer;
    }
    .tabbtn.active{ background:#1f3b63; border-color:#355b8f; }

    .card { background:#0f1722; border:1px solid #223244; border-radius:16px; padding:14px; margin-top: 12px; box-shadow: 0 10px 25px rgba(0,0,0,.25); }
    .grid { display:grid; grid-template-columns: 96px 1fr; gap:12px; align-items:center; }
    img.thumb { width:96px; height:96px; object-fit:cover; border-radius:14px; border:1px solid #223244; background:#0b0f14; }

    h2 { font-size: 16px; margin: 0 0 6px 0; }
    .muted { color:#b8c7da; font-size: 13px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; }
    .kv { background:#141c26; border:1px solid #243446; border-radius:12px; padding:10px 12px; }
    .kv b { display:block; font-size: 12px; color:#b8c7da; margin-bottom:2px; }
    .kv span { font-weight:900; }

    .controls { display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top: 12px; }
    button {
      width:100%; padding:14px 14px; border-radius:14px; border:1px solid #2b3f56;
      background:#152235; color:#e8eef6; font-weight:900; font-size: 15px; cursor:pointer;
    }
    button.primary { background:#1f3b63; border-color:#355b8f; }
    button.danger { background:#3a1c22; border-color:#6a2a35; }
    button:active { transform: translateY(1px); }

    .footer {
      margin-top: 6px;
      display:flex;
      gap:8px;
      justify-content:space-between;
    }
    .footer button {
      flex: 1;
      min-width: 0;
      padding:10px 12px;
      font-size:14px;
      border-radius:10px;
    }

    .mini { font-size: 12px; color:#b8c7da; margin-top: 10px; line-height: 1.35; }
    .setline { font-variant-numeric: tabular-nums; font-weight: 900; }
    .plan { margin-top:10px; font-size:12px; color:#b8c7da; line-height:1.5; }
    .plan b { color:#e8eef6; }
    .warn { display:none; margin-top:8px; color:#ffb4b4; font-size:12px; }

    .top-timer-row {
      display:flex;
      align-items:center;
      gap:8px;
      margin-top:4px;
    }
    .mini-action {
      width:auto;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid #2b3f56;
      background:#152235;
      color:#e8eef6;
      font-weight:700;
      font-size:11px;
      cursor:pointer;
    }
    .mini-action.primary {
      background:#1f3b63;
      border-color:#355b8f;
    }

    button.ghost {
      background:#0f1722;
      border-color:#2b3f56;
      color:#b8c7da;
    }
    button.ghost:active {
      transform: translateY(1px);
    }

    .next-ready {
      background: #1f8f4a !important;
      border-color: #29b15c !important;
      color: #ffffff !important;
    }

    .quote {
      margin-top: 10px;
      padding: 10px 12px;
      background: #111820;
      border-left: 4px solid #f5c400;
      color: #f5c400;
      font-weight: 900;
      font-size: 13px;
      line-height: 1.35;
      border-radius: 8px;
      position: relative;
      padding-right: 28px;
    }

    .quote-audio-icon {
      position: absolute;
      top: 6px;
      right: 6px;
      font-size: 13px;
      cursor: pointer;
      opacity: 0.85;
      user-select: none;
    }
    .quote-audio-icon:hover {
      opacity: 1;
    }
    .quote-audio-icon.off {
      opacity: 0.45;
    }

    .award-img {
      opacity: 0;
      transform: scale(0.6);
    }
    .award-img.animate-in {
      animation: awardIn 5s ease-out forwards;
    }
    @keyframes awardIn {
      0% {
        opacity: 0;
        transform: scale(0.6);
      }
      30% {
        opacity: 1;
        transform: scale(1.05);
      }
      60% {
        opacity: 1;
        transform: scale(0.98);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="pill">
        <div class="muted">Workout</div>
        <div class="top-timer-row">
          <div class="time big" id="workoutTime">0:00</div>
          <button class="mini-action primary" id="btnStartWorkout">Start</button>
        </div>
      </div>
      <div class="pill">
        <div class="muted">Rest</div>
        <div class="top-timer-row">
          <div class="time big" id="restTime">0:00</div>
          <button class="mini-action" id="btnStartRest">Start</button>
        </div>
      </div>
    </div>

    <div class="tabs">
      <label class="muted" for="daySelect">Day</label>
      <select id="daySelect" class="day-select">
        <option value="day1">Upper 1 ‚Äì Push</option>
        <option value="day2">Upper 2 ‚Äì Pull</option>
        <option value="day3">Upper 3 ‚Äì Shoulders & Arms</option>
        <option value="leg1">Leg 1 ‚Äì Quads & Glutes</option>
        <option value="leg2">Leg 2 ‚Äì Posterior Chain</option>
      </select>
    </div>

    <div class="card">
      <!-- Normal exercise view -->
      <div class="grid" id="exerciseGrid">
        <div>
          <img class="thumb" id="exImg" alt="exercise image"
               onerror="this.style.display='none'; document.getElementById('imgErr').style.display='block';" />
          <div class="warn" id="imgErr">Image not found ‚Äî check filename in repo (must match exactly).</div>

          <div id="quoteBox" class="quote">
            <span id="quoteText">‚ÄúEvery workout is a step forward.‚Äù</span>
            <span id="toggleQuoteAudio" class="quote-audio-icon">üîä</span>
          </div>
        </div>

        <div>
          <!-- SWAP: header row with swap button -->
          <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
            <h2 id="exName" style="margin:0;">‚Äî</h2>
            <button
              id="btnSwapExercise"
              class="mini-action"
              title="Swap this exercise"
              style="font-size:11px; padding:4px 8px;"
            >
              üîÅ
            </button>
          </div>

          <div class="muted" id="exNotes">‚Äî</div>

          <div class="row">
            <div class="kv"><b>Sets √ó Reps</b><span id="exSetsReps">‚Äî</span></div>
            <div class="kv"><b>Beginner Weight</b><span id="exWeight">‚Äî</span></div>
            <div class="kv"><b>Set</b><span class="setline" id="exSetTracker">‚Äî</span></div>
          </div>
        </div>
      </div>

      <!-- Workout complete view -->
      <div id="completionView"
           style="display:none; text-align:center; padding:16px 8px;">
        <img id="completionImg"
             class="award-img"
             src=""
             alt="Workout complete"
             style="width:100%; height:auto; border-radius:16px; margin-bottom:12px; display:block;">

        <!-- NEW: button + summary box -->
        <button
          id="btnShowSummary"
          class="mini-action primary"
          style="margin-bottom:8px; margin-top:4px;"
        >
          Show Completed Workout
        </button>

        <div
          id="completionSummary"
          style="display:none; text-align:left; font-size:13px; background:#101827; border-radius:12px; padding:10px; border:1px solid #223244; margin-top:4px;"
        ></div>

        <audio id="completionAudio"></audio>
      </div>

      <div class="controls">
        <button id="btnSetDone">Set Done</button>
        <button class="danger" id="btnResetSet">Reset Sets</button>
      </div>

      <div class="footer">
        <button id="btnPrev" class="ghost">‚óÄ Prev</button>
        <button id="btnNext" class="primary">Next ‚ñ∂</button>
      </div>

      <div class="mini">
        <b>Rules:</b> leave ~2 reps in reserve; clean form.
        <b>Progress:</b> hit top reps on all sets ‚Üí add 5 lb next session.
      </div>

      <div class="plan" id="planList"></div>
    </div>

  </div>

  <!-- AUDIO ELEMENTS -->
  <audio id="audioIntro" src="intro.mp3"></audio>
  <audio id="audioSetDone" src="set-done.mp3"></audio>
  <audio id="audioRestComplete" src="rest-complete.mp3"></audio>
  <audio id="audioWorkoutComplete" src="workout-complete.mp3"></audio>
  <audio id="audioSwipe" src="swipe.mp3"></audio>
  <audio id="audioFinalSet" src="final-set.mp3"></audio>
  <audio id="quoteAudio"></audio>
  
<script>
  // ---------------------------
  // QUOTES (text + mp3 mapping)
  // ---------------------------
  const QUOTE_TEXTS = [
    /* 1 */ "Every workout is a step forward.",
    /* 2 */ "You miss 100% of the shots you don't take.",
    /* 3 */ "Your limits are all in your mind.",
    /* 4 */ "Motivation ignites the spark, habit fuels the fire.",
    /* 5 */ "Strength does not come from physical capacity. It comes from an indomitable will.",
    /* 6 */ "Success isn't about greatness. It's about consistency.",
    /* 7 */ "There are no shortcuts to any place worth going.",
    /* 8 */ "Endure the pain, enjoy the gain.",
    /* 9 */ "No matter how slow you go, you're still lapping everybody on the couch.",
    /* 10 */ "The body achieves what the mind believes.",
    /* 11 */ "The only place where success comes before work is in the dictionary.",
    /* 12 */ "I'm a great believer in luck, and I find the harder I work the more I have of it.",
    /* 13 */ "We are what we repeatedly do. Excellence then is not an act but a habit.",
    /* 14 */ "Don't wish it were easier. Wish you were better.",
    /* 15 */ "The hard days are the best because that's when champions are made.",
    /* 16 */ "What you do today can improve all your tomorrows.",
    /* 17 */ "Success is no accident...",
    /* 18 */ "If something stands between you and your success, move it...",
    /* 19 */ "Strong today, stronger tomorrow.",
    /* 20 */ "It's what you do in the dark that puts you in the light.",
    /* 21 */ "Don't wait until you've reached your goal to be proud of yourself.",
    /* 22 */ "Your body hears everything your mind says.",
    /* 23 */ "It's up to you to start making healthy choices today.",
    /* 24 */ "Stay focused. Stay committed. Stay disciplined.",
    /* 25 */ "Slow progress is still progress.",
    /* 26 */ "If it doesn't challenge you, it probably won't change you.",
    /* 27 */ "Discipline is doing what you hate, but doing it like you love it.",
    /* 28 */ "Your future self will thank you for today's workout.",
    /* 29 */ "A river cuts through rock, not because of its power, but because of its persistence.",
    /* 30 */ "Believe in yourself and you will be unstoppable.",
    /* 31 */ "Train like a beast.",
    /* 32 */ "You get what you work for.",
    /* 33 */ "No pain, no gain.",
    /* 34 */ "Push yourself because no one else will do it for you.",
    /* 35 */ "Work out as if your life depends on it, because it does.",
    /* 36 */ "If you want to achieve what very few people do, you have to do what most people won't.",
    /* 37 */ "Get comfortable being uncomfortable.",
    /* 38 */ "What would you rather feel ‚Äî the sting of discipline or the pain of regret?",
    /* 39 */ "If you don't have time to do it right, when will you have time to do it over?",
    /* 40 */ "Discipline equals freedom.",
    /* 41 */ "The only bad workout is the one that didn‚Äôt happen.",
    /* 42 */ "The more you sweat in training, the less you bleed in battle.",
    /* 43 */ "If you're tired of starting over, stop giving up.",
    /* 44 */ "Don't limit your challenges. Challenge your limits.",
    /* 45 */ "Victory loves preparation.",
    /* 46 */ "Be stronger than your excuses.",
    /* 47 */ "What seems impossible today will one day become your warm-up.",
    /* 48 */ "Today's pain is tomorrow's strength.",
    /* 49 */ "Stay consistent and the results will follow.",
    /* 50 */ "Success is the sum of small efforts repeated day in and day out.",
    /* 51 */ "You don't get what you wish for. You get what you work for.",
    /* 52 */ "The way to get started is to quit talking and begin doing.",
    /* 53 */ "The price of excellence is discipline.",
    /* 54 */ "Results happen when excuses stop.",
    /* 55 */ "Show up. Put in the work and Stay consistent.",
    /* 56 */ "Do what you can, with what you have, where you are..",
    /* 57 */ "Today's effort is tomorrow's progress.",
    /* 58 */ "The only limit to our realization of tomorrow will be our doubts of today.",
    /* 59 */ "It always seems impossible until it's done.",
    /* 60 */ "Fall seven times, stand up eight.",
    /* 61 */ "The man who moves a mountain begins by carrying small stones.",
    /* 62 */ "If you train hard, you‚Äôll not only be hard, you‚Äôll be hard to beat.",
    /* 63 */ "A champion is someone who gets up when they can‚Äôt.",
    /* 64 */ "To give anything less than your best is to sacrifice the gift",
    /* 65 */ "Whether you think you can or think you can‚Äôt, you‚Äôre right.",
    /* 66 */ "Strength does not come from winning. Your struggles develop your strengths.",
    /* 67 */ "To be a great champion you must believe you are the best. If you‚Äôre not, pretend you are.",
    /* 68 */ "Effort and courage are not enough without purpose and direction.",
    /* 69 */ "The secret of getting ahead is getting started.",
    /* 70 */ "Don‚Äôt count the reps, make the reps count.",
    /* 71 */ "What you stay focused on will grow.",
    /* 72 */ "Success is never owned, it‚Äôs rented. And the rent is due every day.",
    /* 73 */ "There is no substitute for hard work.",
    /* 74 */ "The greatest wealth is health.",
    /* 75 */ "Champions keep going when the others stop.",
    /* 76 */ "A goal without a plan is just a wish.",
    /* 77 */ "The difference between try and triumph is a little umph.",
  ];

  const QUOTES = QUOTE_TEXTS.map((text, index) => ({
    text,
    audio: `quote${index + 1}.mp3`
  }));

  let quoteAudioEnabled = false;
  let _quoteBag = [];
  let _lastQuote = null;

  function _shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function _refillQuoteBag() {
    _quoteBag = _shuffle([...QUOTES]);
    if (_lastQuote && _quoteBag.length > 1 && _quoteBag[0] === _lastQuote) {
      [_quoteBag[0], _quoteBag[1]] = [_quoteBag[1], _quoteBag[0]];
    }
  }

  function playQuoteAudio(src) {
    if (!src || !quoteAudioEnabled) return;
    const audioEl = document.getElementById("quoteAudio");
    if (!audioEl) return;
    try {
      audioEl.pause();
      audioEl.currentTime = 0;
      audioEl.src = src;
      audioEl.volume = 0.7;
      audioEl.play();
    } catch (e) {}
  }

  function updateQuote() {
    if (_quoteBag.length === 0) _refillQuoteBag();
    const q = _quoteBag.shift();
    _lastQuote = q;
    const textEl = document.getElementById("quoteText");
    if (textEl && q && q.text) {
      textEl.textContent = "‚Äú" + q.text + "‚Äù";
    }
    if (q && q.audio && quoteAudioEnabled) {
      playQuoteAudio(q.audio);
    }
  }

  // COMPLETION ASSETS
  const COMPLETION_IMAGES = [
    "./award1.png",
    "./award2.png",
    "./award3.png",
    "./award4.png",
    "./award5.png",
    "./award6.png",
    "./award7.png"
  ];

  let _awardBag = [];
  function pickAwardImage() {
    if (_awardBag.length === 0) {
      _awardBag = _shuffle([...COMPLETION_IMAGES]);
    }
    return _awardBag.shift();
  }

  const COMPLETION_SOUNDS = [
    "./workout-complete1.mp3",
    "./workout-complete2.mp3",
    "./workout-complete3.mp3",
    "./workout-complete4.mp3",
    "./workout-complete5.mp3",
    "./workout-complete6.mp3",
    "./workout-complete7.mp3"
  ];

  let _soundBag = [];
  function pickCompletionSound() {
    if (_soundBag.length === 0) {
      _soundBag = _shuffle([...COMPLETION_SOUNDS]);
    }
    return _soundBag.shift();
  }

  // DAYS DATA
  const DAYS = {
    day1: {
      label: "Upper 1 ‚Äì Push",
      exercises: [
        { name:"Dumbbell Bench Press", sets:3, reps:"8‚Äì10", weight:"25‚Äì40 lb dumbbells",
          notes:"Controlled reps. Shoulder blades squeezed. Stop 2 reps before failure.", img:"dumbbell-benchpress.gif" },
        { name:"Incline Dumbbell Press", sets:3, reps:"8‚Äì10", weight:"20‚Äì35 lb dumbbells",
          notes:"Bench 30‚Äì45¬∞. Slow lower. Light pause at bottom.", img:"incline-dumbbellpress.gif" },
        { name:"Dumbbell Lateral Raise", sets:3, reps:"12‚Äì15", weight:"10‚Äì15 lb dumbbells",
          notes:"No swing. Raise to shoulder height. Keep traps relaxed.", img:"dumbbell-lateralraise.gif" },
        { name:"Cable Chest Fly", sets:2, reps:"12‚Äì15", weight:"15‚Äì30 lb per side",
          notes:"Big stretch, then squeeze 1 sec at center.", img:"cable-fly.gif" },
        { name:"Rope Triceps Pushdown", sets:3, reps:"10‚Äì12", weight:"30‚Äì50 lb",
          notes:"Elbows pinned. Spread rope at bottom. Full control up.", img:"rope-pushdown.gif" },
      ]
    },

        day2: {
      label: "Upper 2 ‚Äì Pull",
      exercises: [
        { name:"Lat Pulldown", sets:3, reps:"8‚Äì10", weight:"70‚Äì100 lb",
          notes:"Full stretch at top. Pull elbows down. Chest tall.", img:"latpulldown.gif" },
        { name:"Seated Cable Row", sets:3, reps:"10", weight:"70‚Äì110 lb",
          notes:"Chest up. Pull elbows back. Squeeze shoulder blades.", img:"seated-cablerow.gif" },
        { name:"Machine Row", sets:2, reps:"10‚Äì12", weight:"Machine 50‚Äì90 lb",
          notes:"No jerking. Control the negative. Keep torso stable.", img:"seated-row.gif" },
        { name:"Dumbbell Curl", sets:3, reps:"10‚Äì12", weight:"15‚Äì25 lb dumbbells",
          notes:"No swinging. Slow lower. Elbows close to sides.", img:"dumbbell-curl.gif" },
        { name:"Hammer Curl", sets:2, reps:"12", weight:"15‚Äì25 lb dumbbells",
          notes:"Neutral grip. Full range. Control down.", img:"hammer-curl.gif" },
      ]
    },

    day3: {
      label: "Upper 3 ‚Äì Shoulders & Arms",
      exercises: [
        { name:"Machine Shoulder Press", sets:3, reps:"8‚Äì10", weight:"40‚Äì80 lb",
          notes:"Seat so handles start near chin. Control down; don‚Äôt slam the stack.", img:"shoulder-press.gif" },
        { name:"Cable Lateral Raise", sets:3, reps:"12‚Äì15", weight:"5‚Äì15 lb",
          notes:"Smooth reps. Keep shoulder down away from ear.", img:"cable-lateral-raise.gif" },
        { name:"Rear Delt Fly (Machine/Cable)", sets:3, reps:"12‚Äì15", weight:"30‚Äì60 lb",
          notes:"Lead with elbows. Pause 1 sec at peak; don‚Äôt shrug.", img:"rear-delt-fly.gif" },
        { name:"Preacher Curl (Machine/EZ)", sets:3, reps:"10", weight:"30‚Äì60 lb",
          notes:"Full stretch at bottom; no bounce. Control the negative.", img:"preacher-curl.gif" },
        { name:"Overhead Cable Triceps Extension", sets:3, reps:"10‚Äì12", weight:"30‚Äì50 lb",
          notes:"Elbows narrow. Big stretch behind head. Smooth lockout.", img:"overhead-cable-triceps.gif" },
      ]
    },

    leg1: {
      label: "Leg 1 ‚Äì Quads & Glutes",
      exercises: [
        { name:"Leg Press (Machine)", sets:3, reps:"10‚Äì12", weight:"90‚Äì180 lb total",
          notes:"Feet shoulder-width on platform. Control the descent. Do not lock knees hard at the top.", img:"leg-press.gif" },
        { name:"Goblet Squat", sets:3, reps:"10‚Äì12", weight:"25‚Äì45 lb dumbbell",
          notes:"Hold the dumbbell close to chest. Sit between your hips, keep heels down and chest up.", img:"goblet-squat.gif" },
        { name:"Walking Lunge", sets:2, reps:"10 steps per leg", weight:"15‚Äì25 lb dumbbells",
          notes:"Long stride. Front knee tracks over toes, back knee drops toward the floor under control.", img:"walking-lunge.gif" },
        { name:"Leg Extension (Machine)", sets:2, reps:"12‚Äì15", weight:"40‚Äì80 lb",
          notes:"Pause and squeeze at the top. Lower under control; don‚Äôt swing the stack.", img:"leg-extension.gif" },
        { name:"Standing Calf Raise", sets:3, reps:"12‚Äì15", weight:"Bodyweight or light added load",
          notes:"Full stretch at bottom and hard squeeze at top. Use a stable support if needed.", img:"standing-calf-raise.gif" },
      ]
    },

    leg2: {
      label: "Leg 2 ‚Äì Posterior Chain",
      exercises: [
        { name:"Romanian Deadlift (DB/BB)", sets:3, reps:"8‚Äì10", weight:"60‚Äì135 lb total",
          notes:"Soft knees. Push hips back, feel the stretch in hamstrings. Keep back flat, bar close.", img:"romanian-deadlift.gif" },
        { name:"Hip Thrust (Bench/ Machine)", sets:3, reps:"10‚Äì12", weight:"60‚Äì135 lb",
          notes:"Drive through heels. Squeeze glutes hard at top and pause briefly.", img:"hip-thrust.gif" },
        { name:"Leg Curl (Machine)", sets:3, reps:"10‚Äì12", weight:"40‚Äì80 lb",
          notes:"Control the curl and the return. Don‚Äôt slam the stack at extension.", img:"leg-curl.gif" },
        { name:"Bodyweight Step-Up", sets:2, reps:"10 per leg", weight:"Bodyweight or light dumbbells",
          notes:"Plant whole foot on the step. Drive through heel and avoid pushing off the back leg.", img:"step-up.gif" },
        { name:"Seated Calf Raise", sets:3, reps:"12‚Äì15", weight:"25‚Äì70 lb",
          notes:"Slow stretch at bottom, strong squeeze at top. Do not bounce.", img:"seated-calf-raise.gif" },
      ]
    }
  };

    // SWAP: one alternate per exercise (Upper 1 + Upper 2)
  const EXERCISE_ALTS = {
    // Upper 1 ‚Äì Push
    "Dumbbell Bench Press": {
      name: "Smith Machine Bench Press",
      sets: 3,
      reps: "8‚Äì10",
      weight: "25‚Äì40 lb on Smith machine",
      notes: "Set bar just above chest. Feet planted. Lower with control and press straight up.",
      img: "smith-benchpress.gif"
    },
    "Incline Dumbbell Press": {
      name: "Incline Machine Press",
      sets: 3,
      reps: "8‚Äì10",
      weight: "40‚Äì80 lb on machine",
      notes: "Seat so handles start at mid-chest. Press up and slightly back, control the stack.",
      img: "incline-machinepress.gif"
    },
    "Dumbbell Lateral Raise": {
      name: "Cable Lateral Raise (Single Arm)",
      sets: 3,
      reps: "12‚Äì15",
      weight: "5‚Äì15 lb on cable",
      notes: "Cable starts by hip. Lead with elbow to shoulder height, slow lower down.",
      img: "cable-lateralraise-single.gif"
    },
    "Cable Chest Fly": {
      name: "Dumbbell Chest Fly (Flat Bench)",
      sets: 2,
      reps: "12‚Äì15",
      weight: "10‚Äì25 lb dumbbells",
      notes: "Soft elbows. Big chest stretch, then squeeze dumbbells together over chest.",
      img: "dumbbell-fly.gif"
    },
    "Rope Triceps Pushdown": {
      name: "Dumbbell Overhead Triceps Extension",
      sets: 3,
      reps: "10‚Äì12",
      weight: "20‚Äì35 lb dumbbell",
      notes: "Hold one dumbbell overhead. Elbows in, big stretch behind head, strong lockout.",
      img: "db-overhead-triceps.gif"
    },

    // Upper 2 ‚Äì Pull
    "Lat Pulldown": {
      name: "High Row (Machine)",
      sets: 3,
      reps: "8‚Äì10",
      weight: "40‚Äì80 lb on machine",
      notes: "Sit tall with chest up. Pull elbows down and back, squeeze shoulder blades, control the negative.",
      img: "high-row-machine.gif"
    },
    "Seated Cable Row": {
      name: "Chest-Supported Dumbbell Row",
      sets: 3,
      reps: "10",
      weight: "20‚Äì40 lb dumbbells",
      notes: "Bench at 30‚Äì45¬∞. Chest on pad. Row dumbbells toward lower ribs, no swinging, slow lower.",
      img: "chest-supported-db-row.gif"
    },
    "Machine Row": {
      name: "Dumbbell Row (Bench Supported)",
      sets: 2,
      reps: "10‚Äì12",
      weight: "25‚Äì45 lb dumbbells",
      notes: "One knee and hand on bench. Keep back flat, pull elbow toward hip, control the negative.",
      img: "dumbrow.gif"
    },
    "Dumbbell Curl": {
      name: "EZ-Bar Curl",
      sets: 3,
      reps: "10‚Äì12",
      weight: "30‚Äì60 lb EZ-bar or straight bar",
      notes: "Elbows pinned to sides. Curl under control with a slow lower.",
      img: "ezbar-curl.gif"
    },
    "Hammer Curl": {
      name: "Rope Hammer Curl (Cable)",
      sets: 2,
      reps: "12",
      weight: "30‚Äì50 lb on cable stack",
      notes: "Neutral grip the whole time. Elbows close. Squeeze at the top and control down.",
      img: "rope-hammer-curl.gif"
    }
  };


  // Remember original vs swapped per (day:index)
  const SWAP_STATE = {};

  // STATE
  let currentDayKey = "day1";
  let idx = 0;
  let workoutComplete = false;
  let workoutStart = null;
  let workoutTimerId = null;
  let restSeconds = 0;
  let restTimerId = null;

  // NEW: summary visibility + completion timestamp
  let summaryVisible = false;
  let workoutCompletedAt = null;

  const el = (id) => document.getElementById(id);

  function playSound(id) {
    const a = document.getElementById(id);
    if (!a) return;
    try {
      a.currentTime = 0;
      a.volume = 0.7;
      a.play();
    } catch (e) {}
  }

  function fmt(sec) {
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    return `${m}:${String(s).padStart(2, "0")}`;
  }

  // Helper: parse average of all numbers in a string ("8‚Äì10", "25‚Äì40 lb", "10 steps per leg")
  function parseAverageFromString(str) {
    if (!str) return null;
    const matches = String(str).match(/\d+(\.\d+)?/g);
    if (!matches || matches.length === 0) return null;
    const nums = matches.map(parseFloat);
    const sum = nums.reduce((a, b) => a + b, 0);
    return sum / nums.length;
  }

  function parseAvgWeight(str) {
    return parseAverageFromString(str);
  }

  function parseAvgReps(str) {
    return parseAverageFromString(str);
  }

  function startWorkoutTimer() {
    if (workoutTimerId) return;
    workoutStart = Date.now();
    workoutTimerId = setInterval(() => {
      const elapsed = Math.floor((Date.now() - workoutStart) / 1000);
      el("workoutTime").textContent = fmt(elapsed);
    }, 250);
  }

  function resetWorkoutTimer() {
    if (workoutTimerId) clearInterval(workoutTimerId);
    workoutTimerId = null;
    workoutStart = null;
    el("workoutTime").textContent = "0:00";
  }

  function stopRestTimer() {
    if (restTimerId) clearInterval(restTimerId);
    restTimerId = null;
    restSeconds = 0;
    el("restTime").textContent = "0:00";
  }

  function startRestTimer(seconds = 75) {
    stopRestTimer();
    restSeconds = seconds;
    el("restTime").textContent = fmt(restSeconds);
    restTimerId = setInterval(() => {
      restSeconds--;
      el("restTime").textContent = fmt(Math.max(restSeconds, 0));
      if (restSeconds <= 0) {
        clearInterval(restTimerId);
        restTimerId = null;
        playSound("audioRestComplete");
        if (navigator.vibrate) navigator.vibrate([120, 80, 120]);
      }
    }, 1000);
  }

  function getExercises() {
    return DAYS[currentDayKey].exercises;
  }

  function renderTabs() {
    const sel = el("daySelect");
    if (sel && sel.value !== currentDayKey) {
      sel.value = currentDayKey;
    }
  }

  function render() {
    renderTabs();
    const list = getExercises();
    const ex = list[idx];

    if (typeof ex.doneSets !== "number") ex.doneSets = 0;

    const exerciseGrid = el("exerciseGrid") || document.querySelector(".grid");
    const completionView = el("completionView");
    const row = document.querySelector(".row");
    const btnSet = el("btnSetDone");
    const btnReset = el("btnResetSet");
    const rulesBox = document.querySelector(".mini");
    const swapBtn = el("btnSwapExercise");

    if (workoutComplete) {
      if (exerciseGrid) exerciseGrid.style.display = "none";
      if (completionView) completionView.style.display = "block";

      if (el("exImg")) el("exImg").style.display = "none";
      if (el("imgErr")) el("imgErr").style.display = "none";
      if (el("quoteBox")) el("quoteBox").style.display = "none";
      if (el("exName")) el("exName").style.display = "none";
      if (el("exNotes")) el("exNotes").style.display = "none";
      if (row) row.style.display = "none";
      if (btnSet) btnSet.style.display = "none";
      if (btnReset) btnReset.style.display = "none";
      if (swapBtn) swapBtn.style.display = "none";

      if (el("btnPrev")) el("btnPrev").style.display = "none";
      if (el("btnNext")) el("btnNext").style.display = "none";

      if (el("planList")) el("planList").style.display = "none";
      if (rulesBox) rulesBox.style.display = "none";

    } else {
      if (exerciseGrid) exerciseGrid.style.display = "grid";
      if (completionView) completionView.style.display = "none";

      if (el("quoteBox")) el("quoteBox").style.display = "block";
      if (el("exName")) el("exName").style.display = "block";
      if (el("exNotes")) el("exNotes").style.display = "block";
      if (row) row.style.display = "flex";
      if (btnSet) btnSet.style.display = "inline-block";
      if (btnReset) btnReset.style.display = "inline-block";

      if (el("btnPrev")) el("btnPrev").style.display = "inline-block";
      if (el("btnNext")) el("btnNext").style.display = "inline-block";

      if (el("planList")) el("planList").style.display = "block";
      if (rulesBox) rulesBox.style.display = "block";

      el("imgErr").style.display = "none";
      el("exImg").style.display = "block";

      el("exName").textContent = `${idx + 1}/${list.length}: ${ex.name}`;
      el("exNotes").textContent = ex.notes;
      el("exSetsReps").textContent = `${ex.sets} √ó ${ex.reps}`;
      el("exWeight").textContent = ex.weight;
      el("exSetTracker").textContent = `Set ${ex.doneSets}/${ex.sets}`;

            el("exImg").src = "./" + ex.img;

      // SWAP visibility: only show button if an alternate exists
      if (swapBtn) {
        const key = currentDayKey + ":" + idx;
        const state = SWAP_STATE[key];
        const originalName = state ? state.original.name : ex.name;
        const hasAlt = !!EXERCISE_ALTS[originalName];
        swapBtn.style.display = hasAlt ? "inline-block" : "none";
      }

      updateQuote();

    }

    el("planList").innerHTML = list
      .map((w, i) => {
        if (typeof w.doneSets !== "number") w.doneSets = 0;
        const isCurrent = i === idx;
        const isComplete = w.doneSets >= w.sets;
        let marker = "‚Ä¢";
        if (isComplete && isCurrent) marker = "‚úÖüëâ";
        else if (isComplete) marker = "‚úÖ";
        else if (isCurrent) marker = "üëâ";
        return `${marker} <b>${w.name}</b> ‚Äî ${w.sets}√ó${w.reps} ‚Äî ${w.weight}`;
      })
      .join("<br>");

    const nextBtn = el("btnNext");
    if (ex.doneSets >= ex.sets) {
      nextBtn.classList.add("next-ready");
    } else {
      nextBtn.classList.remove("next-ready");
    }
  }

  // Build the "completed workout" summary
  function buildCompletionSummary() {
    const box = el("completionSummary");
    if (!box) return;

    const day = DAYS[currentDayKey];
    const list = day.exercises;

    let totalPlanned = 0;
    let totalDone = 0;
    let totalLoad = 0;

    const dt = workoutCompletedAt || new Date();
    const dtString = dt.toLocaleString(undefined, {
      dateStyle: "medium",
      timeStyle: "short"
    });

    const lines = [];
    lines.push(`<b>Workout completed:</b> ${dtString}`);

    list.forEach((w, i) => {
      const planned = w.sets || 0;
      const done = typeof w.doneSets === "number" ? w.doneSets : 0;
      totalPlanned += planned;
      totalDone += done;

      const key = currentDayKey + ":" + i;
      const state = SWAP_STATE[key];
      const swapped = state && state.swapped;

      const nameLabel = swapped ? `${w.name} üîÅ` : w.name;
      const status = done >= planned ? "‚úÖ" : "‚Ä¢";

      // Approx load calc for this exercise
      const avgWeight = parseAvgWeight(w.weight);
      const avgReps = parseAvgReps(w.reps);
      if (avgWeight != null && done > 0) {
        const repsPerSet = avgReps != null ? avgReps : 10;
        totalLoad += done * avgWeight * repsPerSet;
      }

      lines.push(`${status} <b>${nameLabel}</b><br>
      Sets: ${done}/${planned} ‚Äî ${w.reps || ""}<br>
      Weight: ${w.weight || ""}`);
    });

    const totalLoadRounded = Math.round(totalLoad);
    let footer = `<hr style="border:none;border-top:1px solid #243446;margin:8px 0;">
       <b>Total sets completed:</b> ${totalDone}/${totalPlanned}`;
    if (totalLoadRounded > 0) {
      footer += `<br><b>Approx. total load moved:</b> ${totalLoadRounded.toLocaleString()} lb`;
    }

    lines.push(footer);

    box.innerHTML = lines.join("<br><br>");
  }

  function toggleCompletionSummary() {
    const box = el("completionSummary");
    const btn = el("btnShowSummary");
    if (!box || !btn) return;

    if (!summaryVisible) {
      buildCompletionSummary();
      box.style.display = "block";
      btn.textContent = "Hide Completed Workout";
    } else {
      box.style.display = "none";
      btn.textContent = "Show Completed Workout";
    }
    summaryVisible = !summaryVisible;
  }

  function nextExercise() {
    stopRestTimer();
    el("btnNext").classList.remove("next-ready");

    const list = getExercises();

    if (idx < list.length - 1) {
      workoutComplete = false;
      idx++;
      render();
      return;
    }

    list.forEach(ex => {
      if (typeof ex.doneSets !== "number") ex.doneSets = 0;
    });

    const allDone = list.every(ex => ex.doneSets >= ex.sets);

    if (!allDone) {
      const firstIncompleteIndex = list.findIndex(ex => ex.doneSets < ex.sets);

      if (navigator.vibrate) navigator.vibrate([80, 60, 80]);

      alert("Finish all sets for every exercise before completing the workout.");

      if (firstIncompleteIndex !== -1) {
        idx = firstIncompleteIndex;
      }
      workoutComplete = false;
      render();
      return;
    }

    workoutComplete = true;
    workoutCompletedAt = new Date(); // stamp completion moment

    // Reset summary state whenever a new workout completes
    summaryVisible = false;
    const summaryBox = el("completionSummary");
    const summaryBtn = el("btnShowSummary");
    if (summaryBox) summaryBox.style.display = "none";
    if (summaryBtn) summaryBtn.textContent = "Show Completed Workout";

    const img = el("completionImg");
    if (img && COMPLETION_IMAGES.length > 0) {
      const src = pickAwardImage();
      img.classList.remove("animate-in");
      img.style.opacity = 0;
      img.style.transform = "scale(0.6)";
      img.onload = () => {
        void img.offsetWidth;
        img.classList.add("animate-in");
      };
      img.src = src + "?v=" + Math.random();
    }

    const ca = el("completionAudio");
    if (ca && COMPLETION_SOUNDS.length > 0) {
      try {
        const soundSrc = pickCompletionSound();
        ca.pause();
        ca.currentTime = 0;
        ca.src = soundSrc + "?v=" + Math.random();
        ca.volume = 0.3;
        ca.play();
      } catch (e) {}
    }
    render();
  }

  function prevExercise() {
    stopRestTimer();
    workoutComplete = false;
    idx = Math.max(idx - 1, 0);
    render();
  }

  function setDone() {
    const list = getExercises();
    const ex = list[idx];
    const nextBtn = el("btnNext");

    if (typeof ex.doneSets !== "number") ex.doneSets = 0;

    if (ex.doneSets >= ex.sets) {
      if (navigator.vibrate) navigator.vibrate(150);
      playSound("audioFinalSet");
      nextBtn.classList.add("next-ready");
      return;
    }

    ex.doneSets++;

    if (ex.doneSets >= ex.sets) {
      stopRestTimer();
      if (navigator.vibrate) navigator.vibrate(150);
      playSound("audioFinalSet");
      nextBtn.classList.add("next-ready");
    } else {
      nextBtn.classList.remove("next-ready");
      playSound("audioSetDone");
      startRestTimer(75);
    }

    render();
  }

  function resetSets() {
    const list = getExercises();
    const ex = list[idx];
    ex.doneSets = 0;
    stopRestTimer();
    el("btnNext").classList.remove("next-ready");
    render();
  }

  function switchDay(dayKey) {
    currentDayKey = dayKey;
    idx = 0;
    workoutComplete = false;
    stopRestTimer();
    resetWorkoutTimer();
    el("btnNext").classList.remove("next-ready");
    workoutCompletedAt = null;
    render();
  }

  // SWAP: toggle current exercise between original and alt
  function swapExercise() {
    const list = getExercises();
    const ex = list[idx];
    if (!ex) return;

    const key = currentDayKey + ":" + idx;
    let state = SWAP_STATE[key];

    if (!state) {
      const alt = EXERCISE_ALTS[ex.name];
      if (!alt) return; // no alert, just bail
      SWAP_STATE[key] = {
        original: { ...ex },
        swapped: true
      };

      list[idx] = {
        ...alt,
        doneSets: 0
      };
    } else {
      if (state.swapped) {
        list[idx] = {
          ...state.original,
          doneSets: 0
        };
        state.swapped = false;
      } else {
        const alt = EXERCISE_ALTS[state.original.name];
        if (!alt) return;
        list[idx] = {
          ...alt,
          doneSets: 0
        };
        state.swapped = true;
      }
    }

    stopRestTimer();
    el("btnNext").classList.remove("next-ready");
    render();
  }

  function updateQuoteAudioIcon() {
    const icon = el("toggleQuoteAudio");
    if (!icon) return;
    icon.textContent = quoteAudioEnabled ? "üîä" : "üîá";
    if (quoteAudioEnabled) {
      icon.classList.remove("off");
    } else {
      icon.classList.add("off");
    }
  }

  // EVENTS
  el("btnStartWorkout").addEventListener("click", startWorkoutTimer);
  el("btnStartRest").addEventListener("click", () => startRestTimer(75));
  el("btnSetDone").addEventListener("click", () => { startWorkoutTimer(); setDone(); });
  el("btnResetSet").addEventListener("click", resetSets);

  el("btnNext").addEventListener("click", () => {
    playSound("audioSwipe");
    nextExercise();
  });

  el("btnPrev").addEventListener("click", () => {
    playSound("audioSwipe");
    prevExercise();
  });

  const daySel = el("daySelect");
  if (daySel) {
    daySel.addEventListener("change", (e) => switchDay(e.target.value));
  }

  const quoteIcon = el("toggleQuoteAudio");
  if (quoteIcon) {
    quoteIcon.addEventListener("click", () => {
      quoteAudioEnabled = !quoteAudioEnabled;
      updateQuoteAudioIcon();

      if (!quoteAudioEnabled) {
        const qa = el("quoteAudio");
        if (qa) {
          qa.pause();
          qa.currentTime = 0;
        }
      }
    });
    updateQuoteAudioIcon();
  }

  // SWAP button event
  const swapBtn = el("btnSwapExercise");
  if (swapBtn) {
    swapBtn.addEventListener("click", () => {
      playSound("audioSwipe");
      swapExercise();
    });
  }

  // SUMMARY button event
  const summaryBtn = el("btnShowSummary");
  if (summaryBtn) {
    summaryBtn.addEventListener("click", toggleCompletionSummary);
  }

  render();

  window.addEventListener("load", () => {
    playSound("audioIntro");
  });
</script>
  
<!-- PWA: Register Service Worker -->
<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker
        .register("./service-worker.js")
        .then(reg => console.log("Service worker registered:", reg.scope))
        .catch(err => console.error("Service worker registration failed:", err));
    });
  }
</script>

</body>
</html>
